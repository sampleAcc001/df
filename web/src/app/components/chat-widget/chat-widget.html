<!-- Floating Button -->
<button ngbTooltip="Test Agent" class="btn btn-primary position-fixed bottom-0 end-0 m-4 rounded-circle shadow"
    style="width: 56px; height: 56px; padding: 0;" (click)="toggleChat()" *ngIf="!isOpen">
    <i class="fa-regular fa-envelope m-auto h5"></i>
</button>

<!-- Chat Window -->
<div class="chat-window position-fixed top-0 end-0 h-100 bg-white shadow-lg zindex-tooltip d-flex flex-column"
    style="width: 100%; max-width: 500px; max-height: 100vh;" [class.closed]="!isOpen">

    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between p-3 border-bottom bg-primary text-white">
        <h2 class="fs-5 fw-semibold mb-0">{{AgentInfo.displayName || 'Agent'}}</h2>
        <button (click)="toggleChat()" class="btn btn-link text-white p-0">
            <i class="fa-regular fa-circle-xmark"></i>
        </button>
    </div>

    <!-- Messages -->
    <div #messageContainer class="flex-grow-1 overflow-auto p-3 bg-light" style="max-height: calc(100vh - 150px);">
        <div *ngFor="let msg of messages" class="d-flex mb-2" [ngClass]="{
                'justify-content-start': msg.sender === 'bot',
                'justify-content-end': msg.sender === 'user'
            }">
            <div [ngClass]="{
                'bg-primary bg-opacity-10 text-white': msg.sender === 'bot',
                'bg-success bg-opacity-10 text-success': msg.sender === 'user'
            }" class="px-3 py-2 rounded" style="max-width: 80%;">
                {{ msg.text }}
            </div>
        </div>
    </div>

    <!-- Input -->
    <div class="p-3 border-top bg-white">
        <div class="d-flex gap-2">
            <input [(ngModel)]="newMessage" (keydown.enter)="sendMessage()" type="text"
                placeholder="Type your message..." class="form-control rounded-pill" />
            <button (click)="sendMessage()" class="btn btn-primary rounded-pill">
                Send
            </button>
        </div>
    </div>
</div>